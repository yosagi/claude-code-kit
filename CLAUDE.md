**言語設定**: このプロジェクトでは日本語でのコミュニケーションを基本とします。コード内のコメントやドキュメントも日本語で記述してください。対話において絵文字を使用しても良いです。

## プロジェクト固有情報

プロジェクト固有の情報は `reports/project_context.md` に集約する。
このファイル（CLAUDE.md）には汎用的なワークフロー定義のみを残し、編集しない。

記載する内容の例：
- **概要・スコープ**（冒頭に必須。プロジェクト間連携で相手を探すときに参照される）
- /init によるコードベース分析結果
- プロジェクトの目標・方針
- アーキテクチャの決定事項
- プロジェクト固有の規約やルール

@reports/project_context.md

## ドキュメント管理

**重要**: ファイル名に日付を含める際、日付や時刻がわからない場合は `date` コマンドで確認すること。

### ドキュメントの種類と保存先

**重要**: プロジェクト管理に関するドキュメントはすべて `reports/` 以下に作成する。プロジェクトルート直下やその他の場所にドキュメントを作成してはならない。

開発過程で作成するドキュメントは以下のディレクトリに保存する：

**`reports/`** - 個人用・内部向けドキュメント
- **ideas/**: アイデア段階のメモ（ファイル分割、INDEX.md で一覧管理）
- **todos/**: 中長期的な技術的課題や改善事項（ファイル分割、INDEX.md で一覧管理）
- **調査レポート**: 技術調査や分析結果（詳細版、作業メモを含む）
- **実装ログ**: `reports/tasks/YYYY-MM-DD_task_[TOPIC].md` - Plan Modeで計画した作業の記録

**`reports/pub/`** - 外部共有用ドキュメント
- 同僚や外部に共有するためのコンパクトな文書
- 文語体で記述し、要点を絞った内容にする

## 実装プロセス

### Plan Modeとの連携

Plan Modeを使用する場合、以下の流れで作業する：

1. **Plan Mode中**
   - システム指定の計画ファイル（Plan file、`~/.claude/plans/`）に計画を書く
   - 計画ファイルには以下の実装ログセクションを含め、実装ログを更新しながら実装する計画を立案する：
     ```
     ## 実装ログ
     - パス: `reports/tasks/YYYY-MM-DD_task_[TOPIC].md`
     - ExitPlanMode 承認後、コード編集前に作成
     - 実装中は進捗・問題発生時に随時更新
     - 完了時に完了報告を記載
     ```
2. **ExitPlanMode 承認直後**
   - **最初のアクションとして**実装ログファイルを作成
   - 計画ファイルの内容を実装ログに転記または要約
   - 実装ログ作成後、コードの編集を開始

3. **実装中**
   - 進捗や問題発生時に実装ログを随時更新

4. **実装完了時**
   - 実装ログに完了報告を記載
   - 計画ファイルは次のPlan Modeで上書きされるが、実装ログは残る

**注**: 計画ファイルは一時的な作業用、実装ログは永続的な記録用として使い分ける。

### 実装前：計画立案

Plan Modeで計画を立てた場合は、実装に移る前に必ず実装ログを作成し、提案した計画を記録すること。Plan Modeを使わない小規模な作業では実装ログは不要。曖昧な点がある場合は必ずユーザに確認し、明確化してから着手すること。

**記載内容：**
1. **作業の目的と課題**: 解決を試みる課題
2. **スコープ**: 達成すべき機能要件と今回対象外とする事項
3. **実装方針**: 技術的アプローチと設計方針
4. **対象ファイル**: 編集予定のファイル一覧

大規模実装の場合は段階的に実装し、各段階と全体について上記を記載する。

### 実装中：進捗管理

実装ログを参照しながら作業し、状況変化のたびに以下を即時更新する：

1. **ロードマップと進捗**: フェーズごとの計画と現在の進捗
2. **後回し項目**: 実装を延期した機能とその理由
3. **簡易実装及びプレースホルダ項目**: 暫定的に簡単な方法やプレースホルダとして実装した箇所
4. **技術的課題**: 解決済み・未解決の技術的問題

**注**: 2-3の項目は原則として避けるべきだが、やむを得ず発生した場合は必ず記録し、後で改善する。

### 実装後：完了報告

作業完了時には実装ログに以下を追記する：

- 課題達成状況の報告
- 実装品質の評価（簡易実装やプレースホルダが残る場合は列挙）
- Git commit用のcommit message案

小規模作業でも、後回し項目・簡易実装・プレースホルダに該当するものがあれば作業終了時に報告すること。

## 実装の原則と制約

### ファイル管理

- テスト等に必要な一時ファイルはプロジェクト下の tmp/ ディレクトリ内に作成して使用する。システムの /tmp はこの用途に使ってはならない。

### スクリプト管理

**`scratch/`** - 書き散らし用（.gitignore 推奨）
- 試しに動かすだけのスクリプト
- 管理不要、いつ消しても良い

**`junktools/`** - 再利用可能なガラクタ道具（git 管理）
- INDEX.md に各スクリプトの説明（数行）を記載
- 各ファイル冒頭にヘッダーコメント必須：
  ```python
  # 目的:
  # 関連:
  # 前提:
  ```

## タスク管理とワークフロー

### ファイル分割によるタスク管理

中長期的な技術的課題や改善事項を `reports/ideas/` と `reports/todos/` でファイル分割して管理する。

※ TodoWriteツール（セッション内の一時管理）とは別の仕組み

#### ディレクトリ構造

```
reports/
├── ideas/
│   ├── INDEX.md           ← セッション開始時に自動ロード
│   ├── YYYY-MM-DD_priority_name.md
│   ├── done/              ← 実装済みのアイデア
│   └── rejected/          ← やらないことにしたアイデア
├── todos/
│   ├── INDEX.md           ← セッション開始時に自動ロード
│   ├── YYYY-MM-DD_priority_name.md
│   ├── done/              ← 完了したタスク
│   └── rejected/          ← やらないことにしたタスク
```

#### ファイル名規約

`YYYY-MM-DD_priority_name.md`

- **日付**: 作成日（ideas）、TODO化日（todos）、完了日（done内）
- **優先度**: `high` / `mid` / `low`
- **名前**: 内容を示す短い英語名（snake_case）

例: `2025-12-21_mid_setup_permissions.md`

### ライフサイクル

```
[アイデア発生]
    ↓
ideas/YYYY-MM-DD_priority_name.md 作成
ideas/INDEX.md に追加
    ↓
    ├─[やらない] → ideas/rejected/ に移動、INDEX から削除
    │
    └─[固まった] → todos/ に移動（日付を TODO 化日に更新）
                   ideas/INDEX から削除、todos/INDEX に追加
                   詳細な計画を追記
                       ↓
                       ├─[やらない] → todos/rejected/ に移動、INDEX から削除
                       │
                       └─[実装開始] → reports/tasks/ に実装ログ作成
                                      TODO ファイル内に実装ログパスを追記
                                          ↓
                                      [実装完了] → todos/done/ に移動（日付を完了日に更新）
                                                  INDEX から削除
                                                  work_history.md に記録
```

### インデックスファイルの形式

```markdown
# IDEAS インデックス

アイデア段階の項目一覧。詳細は各ファイルを参照。

- 2025-12-21_low_persona_system.md: 人格システムの柔軟化
- 2025-12-23_low_memory_decay.md: 記憶の緩やかな減衰
```

### 個別ファイルの形式

```markdown
# タイトル

## 概要
1-2行の説明

## 詳細
本文...
```

完了時には以下を追記：
```markdown
## 完了日
YYYY-MM-DD

## 実装ログ
`reports/tasks/YYYY-MM-DD_task_xxx.md`
```

### 作業の進め方

1. セッション開始時に INDEX.md をレビュー（自動ロードされる）
2. INDEX の内容と現在の状況を踏まえ、次の作業を提案
3. ユーザーの指示に従い、優先度の高い項目から着手
4. 実装作業完了時に、新たにタスク化すべき事項がないか確認

### セッション引き継ぎ

独立したセッション間で連続した作業を遂行するため、「次回やること」を引き継ぐ。
実装ログや TODO, IDEAS と並んで、連続したタスク遂行を実現する仕組みの一つ。

**ファイル**: `reports/next_session.md`

**記録（セッション終了時）**:
1. セッションを終了することが示されたときに
2. 次のセッションで遂行すべきタスクや現在遂行中で未完のタスクがある場合
3. 引き継ぎ用記録ファイル reports/next_session.md にその内容を記録する

**記録内容**:
- 次のセッションで遂行すべきタスクの概要
- 進行中タスクを中断する場合は以下も記録：
  - 中断直前の作業内容（簡潔に）
  - 頻繁に参照しているファイルのパス
  - 実装ログのパス（存在する場合）

前のセッション以前のタスクについて残す必要はなく、次のセッションに引き継ぐべき情報が記載されていれば良い。

**確認（セッション開始時）**:
- 自動読み込みされる内容を確認し、着手したらクリアまたは更新

### プロジェクト間連携（inbox）

他プロジェクトからの依頼を `reports/inbox/` で受け取る。

- セッション開始時に INDEX.md を確認し、`[NEW]` マーカーがあれば新着依頼
- 依頼の送信には `/inbox-send` スキルを使用
- 受信した依頼の確認・完了処理には `/inbox` スキルを使用
  - `/inbox read` - 既読化 + 内容表示
  - `/inbox done` - 完了（done/ に移動）

### 自動読み込みファイル

以下のファイルはセッション開始時に自動的に読み込まれる：

@reports/next_session.md
@reports/ideas/INDEX.md
@reports/todos/INDEX.md
@reports/inbox/INDEX.md
